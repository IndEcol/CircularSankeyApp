<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="CSS/style.css" rel="stylesheet" />
</head>
<body>
    <div class="feature">
        <div class="feature-inner">
            <h1>Data Visualization</h1>
            <h3>An interactive visualization of supply and use tables with Sankey diagrams</h3>
        </div>
    </div>
    <div id="page">
        <header id="header">
            <div id="header-inner">

                <div id="top-nav">
                    <ul>
                        <li><a href="home.html">Project Concept</a></li>
                        <li><a href="documentation.html">Documentation</a></li>
                        <li><a href="code.html">Code</a></li>
                        <li><a href="demo.html">Demo</a></li>
                        <li><a href="future_work.html">Future Work</a></li>
                    </ul>
                </div>
                <div class="clr"></div>
            </div>
        </header>
        
        <div id="content">
            <div id="content-inner">
                <a style="font-size:20px; color:green; font-weight:bold">Contents</a> <br>
                <a style="font-size:16px; color:green; text-decoration: none;" href="#div_introduction">1. Introduction</a> <br>   
                <a style="font-size:16px; color:green; text-decoration: none;" href="#div_structure">2. Project Structure</a> <br>
                    <a style="font-size:12px; padding-left:5em; color:green; text-decoration: none;" href="#div_structure">2.1 Required Technologies</a> <br>

                <a style="font-size:16px; color:green; text-decoration: none;" href="#div_d3">3. Basic Understanding of D3 and Sankey Diagram</a> <br>
                    <a style="font-size:12px; padding-left:5em; color:green; text-decoration: none;" href="#div_d3">3.1 D3 (Data Driven Documents)</a> <br>
                    <a style="font-size:12px; padding-left:5em; color:green; text-decoration: none;" href="#div_sankey">3.2 Sankey Diagram</a> <br>

                <a style="font-size:16px; color:green; text-decoration: none;" href="#div_functional">4. Functional Flow of Circular Sankey</a> <br>
                    <a style="font-size:12px; padding-left:5em; color:green; text-decoration: none;" href="#div_data">4.1 Loading and Parsing Data</a> <br>
                    <a style="font-size:12px; padding-left:5em; color:green; text-decoration: none;" href="#div_SVG">4.2 A close look on SVG elements: Rectangles and Cubic Bézier Curves</a> <br>
                        <a style="font-size:12px; padding-left:10em; color:green; text-decoration: none;" href="#div_SVG_1">4.2.1 How Rectangle and Cubic Bézier Curves work together</a> <br>
                        <a style="font-size:12px; font-weight:bold; padding-left:10em; color:green; text-decoration: none;" href="#div_SVG_2">4.2.2 Coordinate transformation of Rectangles and Curves</a> <br>
                    <a style="font-size:12px; padding-left:5em; color:green; text-decoration: none;" href="#div_database">4.3 Saving Data Into Database</a> <br>
                    <a style="font-size:12px; padding-left:5em; color:green; text-decoration: none;" href="#div_exportSVG">4.4 Exporting Diagram as SVG</a> <br>

                <a style="font-size:16px; color:green; text-decoration: none;" href="#div_userHistory">5. Managing User History</a> <br>
                <a style="font-size:16px; color:green; text-decoration: none;" href="#div_conclusion">6. Conclusion</a> <br>
                <a style="font-size:16px; color:green; text-decoration: none;" href="#div_reference">7. References</a> <br><br>
                

                <div id="div_introduction">
                    <h2>1. Introduction</h2>
                    In recent days where there is huge amount of scientific data is available and needs to present them in a interactive way, data visualization became a important part of software 
                    application especially in web. This implemented circular sankey generates graphical diagram consists of different types of graphical shape (mainly rectangles and curve lines) where 
                    rectangles indicate states and curve lines indicate the flow between the states of a specific system.
                    <br>
                    <br>
                    

                    </div>
                
                <br>

                <div id="div_structure" >
                    <h2>2. Project Structure</h2>
                    
                    <img style="border:thick;  display: block; margin: 0 auto;" height="600" width="700"  src="resource_files/project.jpg" />
                    <br>
                    <br>
                    <h3>2.1 Required Technologies</h3>

                    Circular Sankey is build on the open source tool <a style="color:green; text-decoration: none;" href="https://d3js.org/">D3.js</a> and 
                    its <a style="color:green; text-decoration: none;" href="https://bost.ocks.org/mike/sankey/">Sankey library</a>. We created a seperate Sankey library to handle the 
                    circular property (described later) with the help of available Sankey library. In some cases <a style="color:green; text-decoration: none;" href="">JQuery</a> and 
                    <a style="color:green; text-decoration: none;" href="">JavaScript</a> has been used.
                    <br>
                    As a server side technology, I have used <a style="color:green; text-decoration: none;" href="">ASP.Net 4.5</a> and 
                    <a style="color:green; text-decoration: none;" href="">C#</a> as a server-side language.
                    I have used <a style="color:green; text-decoration: none;" href="">Mysql database</a> as database platform to store user history and login authorization. 
                    <br>
                    I used <a style="color:green; text-decoration: none;" href="">Microsoft Visual Studio 2015</a> as IDE and <a style="color:green; text-decoration: none;" href="">MySQL Workbench 6.3</a>
                    as database IDE.
                </div>

                <br>
                <br>
                <h2>3. Basic Understanding of D3 and Sankey Diagram</h2>
                <br>
                <div id="div_d3" >
                    <h3>3.1 D3 (Data Driven Documents)</h3>

                    Data-Driven Documents (or D3) is a JavaScript API library for producing dynamic, interactive data visualization for the web.
                    D3 enables direct inspection and manipulation of the standard document object model (DOM).
                    Technically, D3.js is a very thin layer on top of modern web technologies to build powerful data visualization with the effective use of SVG, JSON, JQuery, HTML5 and CSS. 
                    It uses pre-built JavaScript functions to select elements, create SVG objects, style them, add transitions or dynamic effects (according to user's requirement) to them, 
                    which can easily be decorated with CSS.
                    <br>
                    Large and complex datasets can be easily bound after parsing into various formats (mostly JSON and CSV) to SVG objects using simple D3.js functions to generate rich text/graphic 
                    charts and diagrams (<a style="color:green; text-decoration: none;" href="https://d3js.org/">see more</a>).
                    <br>
                    


                    <br>

                </div>


                <div id="div_sankey">
                    <h3>3.2 Sankey Diagram</h3>
                    (<a style="color:green; text-decoration: none;" href="https://en.wikipedia.org/wiki/Sankey_diagram">From wikipedia</a>)
                    Sankey diagrams are a specific type of flow diagram, in which the width of the arrows is shown proportionally to the flow quantity.
                    <br>
                    The illustration shows a Sankey diagram which represents all the primary energy flows into a factory. The widths of the bands are directly proportional to energy production, 
                    utilization and losses. The primary energy sources are gas, electricity and coal/oil and represent energy inputs at the left hand side of the Sankey diagram . 
                    They can also visualize the energy accounts, material flow accounts on a regional or national level, and also the breakdown of cost of item or services.
                    <br>
                    <br>
                    Lets look at the bellow's example (<a style="color:green; text-decoration: none;" href="http://www.bbc.co.uk/schools/gcsebitesize/science/aqa/energyefficiency/energytransfersrev3.shtml">see the source</a>)
                    <br>
                    <br>
                    This Sankey diagram for an electric lamp shows that most of the electrical energy is transferred as heat rather than light.
                    <br>
                    <img style="border:thick;  display: block; margin: 0 auto;" height="400" width="400" src="resource_files/example_01.gif" />
                    <br>

                    Energy can be transferred usefully, stored or dissipated. It cannot be created or destroyed. Notice that 100 J of electrical energy is supplied to the lamp. Of this, 10 J is
                    transferred to the surroundings as light energy. The remainder, 90 J (100 J – 10 J) is transferred to the surroundings as heat energy.
                    <br>

                    <br>
                    Lets see another image which is generated using an available online tool (<a style="color:green; text-decoration: none;" href="http://sankeymatic.com/">Sankey Matic</a>).
                    <br>
                    <br>

                    <img style="border:thick;  display: block; margin: 0 auto;" height="600" width="600" src="resource_files/sankeymatic_1200x1200.png" />
                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <pre style="margin: 0; line-height: 125%">                        Wages [<span style="color: #666666">2000</span>] Budget
                        Interest [<span style="color: #666666">25</span>] Budget
                        Budget [<span style="color: #666666">500</span>] Taxes
                        Budget [<span style="color: #666666">450</span>] Housing
                        Budget [<span style="color: #666666">310</span>] Food 
                        Budget [<span style="color: #666666">205</span>] Transportation
                        Budget [<span style="color: #666666">400</span>] Health Care
                        Budget [<span style="color: #666666">160</span>] Other Necessities
</pre>
                    </div>


                    <br>
                    In this particular diagram, we have 9 individual states/nodes drawn as rectangles and among these nodes we have 8 data flows/links which is drawn as curves.
                    Its also needed to mention that these graphical shapes or attributes are basically svg elements that we used here (we will mainly use svg rectangles and svg cubic bézier curves).

                   
                    <br>

                </div>

                <br>

                <div id="div_functional">
                    <h2>4. Functional Flow of Circular Sankey</h2>

                    Basically our circular sankey will follow the bellow's steps to complete its working process.

                    <br>
                    1. Loading data. <br>
                    2. Binding data to elements. <br>
                    3. Transforming elements depending on the bound data. <br>
                    4. Employ transitioning onto elements according to user interaction. <br>
                    <br>


                </div>


                <br>

                <div id="div_data">
                    <h3>4.1 Loading and Parsing Data</h3> <br>
                     Sankey library does not have the luxary to 
                        work on some randome data if its not well structured. Sankey works directly on JSON file format or csv format <br><br>
                    .JSON <br>
                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <pre style="margin: 0; line-height: 125%">{
<span style="color: #BA2121">&quot;nodes&quot;</span><span style="color: #666666">:</span>[
{<span style="color: #BA2121">&quot;name&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Barry&quot;</span>},
{<span style="color: #BA2121">&quot;name&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Frodo&quot;</span>},
{<span style="color: #BA2121">&quot;name&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Elvis&quot;</span>},
{<span style="color: #BA2121">&quot;name&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Sarah&quot;</span>},
{<span style="color: #BA2121">&quot;name&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Alice&quot;</span>}
],
<span style="color: #BA2121">&quot;links&quot;</span><span style="color: #666666">:</span>[
{<span style="color: #BA2121">&quot;source&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Barry&quot;</span>,<span style="color: #BA2121">&quot;target&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Elvis&quot;</span>,<span style="color: #BA2121">&quot;value&quot;</span><span style="color: #666666">:2</span>},
{<span style="color: #BA2121">&quot;source&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Frodo&quot;</span>,<span style="color: #BA2121">&quot;target&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Elvis&quot;</span>,<span style="color: #BA2121">&quot;value&quot;</span><span style="color: #666666">:2</span>},
{<span style="color: #BA2121">&quot;source&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Frodo&quot;</span>,<span style="color: #BA2121">&quot;target&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Sarah&quot;</span>,<span style="color: #BA2121">&quot;value&quot;</span><span style="color: #666666">:2</span>},
{<span style="color: #BA2121">&quot;source&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Barry&quot;</span>,<span style="color: #BA2121">&quot;target&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Alice&quot;</span>,<span style="color: #BA2121">&quot;value&quot;</span><span style="color: #666666">:2</span>},
{<span style="color: #BA2121">&quot;source&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Elvis&quot;</span>,<span style="color: #BA2121">&quot;target&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Sarah&quot;</span>,<span style="color: #BA2121">&quot;value&quot;</span><span style="color: #666666">:2</span>},
{<span style="color: #BA2121">&quot;source&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Elvis&quot;</span>,<span style="color: #BA2121">&quot;target&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Alice&quot;</span>,<span style="color: #BA2121">&quot;value&quot;</span><span style="color: #666666">:2</span>},
{<span style="color: #BA2121">&quot;source&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Sarah&quot;</span>,<span style="color: #BA2121">&quot;target&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;Alice&quot;</span>,<span style="color: #BA2121">&quot;value&quot;</span><span style="color: #666666">:4</span>}
]}
</pre>
                    </div>
                    <br>
                    .csv <br>
                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #BA2121;     font-size: 12px;">
                        <pre style="margin: 0; line-height: 125%">               source,target,value
               Barry,Elvis,<span style="color: #666666">2</span>
               Frodo,Elvis,<span style="color: #666666">2</span>
               Frodo,Sarah,<span style="color: #666666">2</span>
               Barry,Alice,<span style="color: #666666">2</span>
               Elvis,Sarah,<span style="color: #666666">2</span>
               Elvis,Alice,<span style="color: #666666">2</span>
               Sarah,Alice,<span style="color: #666666">4</span>
</pre>
                    </div>

                    <br> <br>
                    <span style="color: green; font-size:14px;">However</span>, We tried to add more control over nodes and flows property by the users. For this reason our input data format will be more complex. Instead of taking only 
                    [name_of_source_node, name_of_target_node, value] properties, we are taking the important information of both nodes [name_of_node] [color] [orientation] [width] [height] [x_position] [y_position] and flows 
                    [name_of_source_node] [value] [flow color] [name_of_target_node] properties from the user. This is the one of the main features that we introduced in our circular sankey tool over the existing 
                    sankey tools. Now if one is become interested to see how sankey library works based on only three [name_of_source_node, name_of_target_node, value] information, I would highly recommend you to read this 
                    article (<a style="color:green; text-decoration: none; font-size:14px" href="http://www.d3noob.org/2013/02/sankey-diagrams-description-of-d3js-code.html">Sankey Diagrams: 
                    A Description of the d3.js Code</a>). <br><br>
                    We have two main way to take data input.  <br>
                    1. By uploading data file in .csv or .xlsx or .txt format. <br>
                    The upload file option take a file from user specified directory and parse the data into our target data format which we use for generating sankey diagram. Data parsing is always
                    very complex as there are varieties of data format is available and therefore effective data parsing to target data format is essential. <br> 

                    2. Using specified input text box direcly. 
                    <br>
                    <br>
                    <span style="color: green">Data format for Nodes:</span> <br>

                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #BA2121;     font-size: 12px;">
                        <pre style="margin: 0; line-height: 125%">Name	         Color	  Orientation  Width   Height  X_position Y_position
Agriculture	(<span style="color: #666666">0</span>, <span style="color: #666666">255</span>, <span style="color: #666666">0</span>)	<span style="color: #666666">0</span>	<span style="color: #666666">40</span>	<span style="color: #666666">80</span>	<span style="color: #666666">150</span>	<span style="color: #666666">250</span>
Waste water	(<span style="color: #666666">255</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>)	<span style="color: #666666">20</span>	<span style="color: #666666">40</span>	<span style="color: #666666">100</span>	<span style="color: #666666">380</span>	<span style="color: #666666">50</span>
Industry	(<span style="color: #666666">222</span>, <span style="color: #666666">83</span>, <span style="color: #666666">36</span>)	<span style="color: #666666">90</span>	<span style="color: #666666">30</span>	<span style="color: #666666">80</span>	<span style="color: #666666">800</span>	<span style="color: #666666">200</span>
Coal Mining	(<span style="color: #666666">167</span>, <span style="color: #666666">98</span>, <span style="color: #666666">36</span>)	<span style="color: #666666">180</span>	<span style="color: #666666">40</span>	<span style="color: #666666">80</span>	<span style="color: #666666">650</span>	<span style="color: #666666">450</span>
Methane	        (<span style="color: #666666">94</span>, <span style="color: #666666">193</span>, <span style="color: #666666">36</span>)	<span style="color: #666666">180</span>	<span style="color: #666666">40</span>	<span style="color: #666666">80</span>	<span style="color: #666666">500</span>	<span style="color: #666666">650</span>
Nitrous Oxide	(<span style="color: #666666">0</span>, <span style="color: #666666">153</span>, <span style="color: #666666">51</span>)	<span style="color: #666666">180</span>	<span style="color: #666666">40</span>	<span style="color: #666666">80</span>	<span style="color: #666666">300</span>	<span style="color: #666666">550</span>
</pre>
                    </div>




                    <br>
                    <span style="color: green">Data format for flows between Nodes:</span> <br>

                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #BA2121;     font-size: 12px;">
                        <pre style="margin: 0; line-height: 125%">Source	       Value	     Color	Target
Agriculture	<span style="color: #666666">12</span>	(<span style="color: #666666">0</span>, <span style="color: #666666">191</span>, <span style="color: #666666">255</span>)	Waste water
Waste water	<span style="color: #666666">10</span>	(<span style="color: #666666">255</span>, <span style="color: #666666">0</span>, <span style="color: #666666">255</span>)	Industry
Industry	<span style="color: #666666">6</span>	(<span style="color: #666666">0</span>, <span style="color: #666666">64</span>, <span style="color: #666666">255</span>)	Coal Mining
Coal Mining	<span style="color: #666666">11</span>	(<span style="color: #666666">153</span>, <span style="color: #666666">0</span>, <span style="color: #666666">115</span>)	Methane
Methane	        <span style="color: #666666">12</span>	(<span style="color: #666666">0</span>, <span style="color: #666666">153</span>, <span style="color: #666666">0</span>)	Nitrous Oxide
Nitrous Oxide	<span style="color: #666666">12</span>	(<span style="color: #666666">255</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>)	Agriculture
</pre>
                    </div>


                    </div>

                <br>
                <br>
                <div id="div_SVG">
                    <h3>4.2 A close look on SVG elements: Rectangles and Cubic Bézier Curves</h3>
                    After parsing data into our target format, our next approach is to create the required svg elements. Let's look at another simplified example figure- (<a style="color:green; 
text-decoration: none; font-size:14px" href="http://www.d3noob.org/2013/02/sankey-diagrams-description-of-d3js-code.html">source</a>)
                    

                        <img style="border:thick; display: block;   margin: 0 auto;" height="400" width="400" src="resource_files/example_02.png" />

                       

                    <br>
                   

                    As we can see, we have three svg attributes here in this figure. The rectangles (nodes), flow curves (links) between rectangles and text (title of nodes). I am not going to describe 
                    how these attributes are done by code as these building blocks are already available (<a style="color:green; text-decoration: none; font-size:14px" href="http://www.d3noob.org/2013/02/sankey-diagrams-description-of-d3js-code.html">
                    Sankey Diagrams:A Description of the d3.js Code</a>). Rather, I would describe the distinct features of our circular sankey which we believe is unique. To support the idea, we are 
                    introducing the circular behavior of Sankey Diagram. As we can see in the picture the orientation of each rectangles is 0 degree or in another sense the rectangles are 
                    straight and the overall information flow of the diagram is flowing from left to right. So, we can say the source is in left side and target is in right side. What if we want something
                    more interactive? For example- what if we want a cycle, where data will be flown a circular way rather than just staright left to right direction (see figure bellow-). To achieve this idea into reality,
                    our first step should be applying transformation onto the rectangles; in other words- we have to apply the orientation value (instead of default 0 degree we will ensure
                    the rectangles are rotating according to user defined angle value ranging (0<=orientation_value>=360)) for rectangles and other related adjustments (we will see more in section 4.2.2).
                    Before that, we will have a look how individual rectangles and curves are created and how they are inter-connected (section 4.2.1): 
                    <br>
                    <img style="border:thick; display: block;   margin: 0 auto;" height="450" width="450" src="resource_files/circular_sankey_03.png" />

                    <br>
                </div>

                <div id="div_SVG_1">
                    <h3>4.2.1 How Rectangle and Cubic Bézier Curves work together</h3>

                        <img style="border:thick; display:inline-block;  margin: 0 auto;" height="250" width="250" src="resource_files/rectangle_1.png" />
                        <img style="border:thick; display:inline-block;  margin: 0 auto;" height="250" width="250" src="resource_files/curves_1.png" />
                        <img style="border:thick; display:inline-block;  margin: 0 auto;" height="250" width="250" src="resource_files/circular_sankey_01.png" />

                  
                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <table>
                            <tr>
                                <td>
                                    <pre style="margin: 0; line-height: 125%">1
2
3</pre>
                                </td>
                                <td>
                                    <pre style="margin: 0; line-height: 125%"><span style="color: #666666">&lt;</span>svg width<span style="color: #666666">=</span><span style="color: #BA2121">&quot;50&quot;</span> height<span style="color: #666666">=</span><span style="color: #BA2121">&quot;50&quot;</span><span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>rect x<span style="color: #666666">=</span><span style="color: #BA2121">&quot;0&quot;</span> y<span style="color: #666666">=</span><span style="color: #BA2121">&quot;0&quot;</span> width<span style="color: #666666">=</span><span style="color: #BA2121">&quot;50&quot;</span> height<span style="color: #666666">=</span><span style="color: #BA2121">&quot;50&quot;</span> fill<span style="color: #666666">=</span><span style="color: #BA2121">&quot;green&quot;</span> <span style="color: #666666">/&gt;</span>
<span style="color: #666666">&lt;</span><span>/svg&gt;</span>
</pre>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <br>

                    <br>


                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <table>
                            <tr>
                                <td>
                                    <pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8
9</pre>
                                </td>
                                <td>
                                    <pre style="margin: 0; line-height: 125%">    <span style="color: #008000; font-weight: bold">var</span> svgContainer <span style="color: #666666">=</span> d3.select(<span style="color: #BA2121">&quot;body&quot;</span>).append(<span style="color: #BA2121">&quot;svg&quot;</span>)
        .attr(<span style="color: #BA2121">&quot;width&quot;</span>, <span style="color: #666666">200</span>)
        .attr(<span style="color: #BA2121">&quot;height&quot;</span>, <span style="color: #666666">200</span>);
    <span style="color: #008000; font-weight: bold">var</span> rectangle <span style="color: #666666">=</span> svgContainer.append(<span style="color: #BA2121">&quot;rect&quot;</span>)
        .attr(<span style="color: #BA2121">&quot;x&quot;</span>, <span style="color: #666666">10</span>)
        .attr(<span style="color: #BA2121">&quot;y&quot;</span>, <span style="color: #666666">10</span>)
        .attr(<span style="color: #BA2121">&quot;width&quot;</span>, <span style="color: #666666">50</span>)
        .attr(<span style="color: #BA2121">&quot;height&quot;</span>, <span style="color: #666666">100</span>);
</pre>
                                </td>
                            </tr>
                        </table>
                    </div>


                    <br>
                    Above two code segments are the very basic of making SVG rectangle. The codes are pretty straight forward and don't need more explanation. The next segment of code is important to
                    understand how Cubic Bézier Curve works.
                    <br>

                    <br>

                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <table>
                            <tr>
                                <td>
                                    <pre style="margin: 0; line-height: 125%">
1
2
3
</pre>
                                </td>
                                <td>
                                    <pre style="margin: 0; line-height: 125%"><span style="color: #666666">&lt;</span>svg width<span style="color: #666666">=</span><span style="color: #BA2121">&quot;190&quot;</span> height<span style="color: #666666">=</span><span style="color: #BA2121">&quot;160&quot;</span><span style="color: #666666">&gt;</span>
   <span style="color: #666666">&lt;</span>path d<span style="color: #666666">=</span><span style="color: #BA2121">&quot;M100,250 C100,100 400,100 400,250" &quot;</span> stroke<span style="color: #666666">=</span><span style="color: #BA2121">&quot;black&quot;</span> fill<span style="color: #666666">=</span><span style="color: #BA2121">&quot;transparent&quot;</span><span style="color: #666666">/&gt;</span>
<span style="color: #666666">&lt;</span><span>/svg&gt;</span>
</pre>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <br>
                    The initial M directive moves the pen to the first point (100,250). Following the ‘C’ are three co-ordinates; the start control point (100,100), 
                    the end control point (400,100) and the final point we’re drawing to (400,250). <br>
                    <br>

                    For Circular sankey, we have this block of code for generating rectangle.
                    <br>


                    <!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <table>
                            <tr>
                                <td>
                                    <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre>
                                </td>
                                <td>
                                    <pre style="margin: 0; line-height: 125%"> <span style="color: #008000; font-weight: bold">var</span> node <span style="color: #666666">=</span> svg.append(<span style="color: #BA2121">&quot;g&quot;</span>).selectAll(<span style="color: #BA2121">&quot;.node&quot;</span>)
           .data(json_data.nodes)          <span style="color: #408080; font-style: italic">// using node properties</span>
           .enter().append(<span style="color: #BA2121">&quot;g&quot;</span>)
           .attr(<span style="color: #BA2121">&quot;class&quot;</span>, <span style="color: #BA2121">&quot;node&quot;</span>)          <span style="color: #408080; font-style: italic">// use CSS named node</span>
           .attr(<span style="color: #BA2121">&quot;transform&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                                    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;translate(&quot;</span> <span style="color: #666666">+</span> d.x <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> d.y <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;)&quot;</span>;        <span style="color: #408080; font-style: italic">//allocate the position of X_coordinate and Y_coordinate from given node data</span>
           })
           .call(d3.behavior.drag()
           .origin(<span style="color: #008000; font-weight: bold">function</span> (d) { <span style="color: #008000; font-weight: bold">return</span> d; })
           .on(<span style="color: #BA2121">&quot;dragstart&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> () { <span style="color: #008000; font-weight: bold">this</span>.parentNode.appendChild(<span style="color: #008000; font-weight: bold">this</span>); })
           .on(<span style="color: #BA2121">&quot;drag&quot;</span>, dragmove));

node.append(<span style="color: #BA2121">&quot;rect&quot;</span>)
           .attr(<span style="color: #BA2121">&quot;width&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
               node_width_counter<span style="color: #666666">++</span>;
                                    <span style="color: #008000; font-weight: bold">return</span> a_node_width[node_width_counter];         <span style="color: #408080; font-style: italic">// manually set width from given node data</span>
           })
           .attr(<span style="color: #BA2121">&quot;height&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                                    <span style="color: #008000; font-weight: bold">return</span> d.dy;                             <span style="color: #408080; font-style: italic">// manually set height from given node data</span>
           })
           .attr(<span style="color: #BA2121">&quot;transform&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                                    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;rotate(&quot;</span> <span style="color: #666666">+</span> d.angle <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;)&quot;</span>         <span style="color: #408080; font-style: italic">// manually set rotation value to each rectangle from given node data</span>
           })
           .attr(<span style="color: #BA2121">&quot;shape-rendering&quot;</span>, <span style="color: #BA2121">&quot;crispEdges&quot;</span>)
           .style(<span style="color: #BA2121">&quot;fill&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
               node_color_counter<span style="color: #666666">++</span>;
                                    <span style="color: #008000; font-weight: bold">return</span> node_color[node_color_counter];           <span style="color: #408080; font-style: italic">// manually set node color from given node data</span>
           })
           .style(<span style="color: #BA2121">&quot;fill-opacity&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                                    <span style="color: #008000; font-weight: bold">return</span> d.opacity <span style="color: #666666">||</span> data_set.default_node_opacity;
           })
           .style(<span style="color: #BA2121">&quot;stroke-width&quot;</span>, data_set.node_border <span style="color: #666666">||</span> <span style="color: #666666">0</span>)
           .style(<span style="color: #BA2121">&quot;stroke&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                                    <span style="color: #008000; font-weight: bold">return</span> node_color[node_color_counter];
           })
                .append(<span style="color: #BA2121">&quot;title&quot;</span>)
           .text(
                                    <span style="color: #008000; font-weight: bold">function</span> (d) {
                                    <span style="color: #008000; font-weight: bold">return</span> data_set.show_labels
                                    <span style="color: #666666">?</span> d.name <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;\n&quot;</span> <span style="color: #666666">+</span> units_format(d.value)
                                    <span style="color: #666666">:</span> <span style="color: #BA2121">&quot;&quot;</span>;
               });
</pre>
                                </td>
                            </tr>
                        </table>
                    </div>



                    <br>
                    The original sankey library sets all these rectangle properties automatically, that means user has absolutely no control. This is sometimes useful when someone tries to avoid complexity
                    or doesn't care about setting own interest manually. On the other hand, this is very useful and meaningful if someone wants more interactive diagram by imposing own interest 
                    and deal with the circular property that we discussed above. These manual node properties should give much flexible nodes matching with user interest but its yet to be achieved
                    taking care of some other changes (we will come to this point).
                    <br>
                    <br>
                    Now lets have look how links/flows/Curves between the nodes/rectangles are formed.
                    <br>

                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <table>
                            <tr>
                                <td>
                                    <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre>
                                </td>
                                <td>
                                    <pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">var</span> link <span style="color: #666666">=</span> svg.append(<span style="color: #BA2121">&quot;g&quot;</span>).selectAll(<span style="color: #BA2121">&quot;.link&quot;</span>)
            .data(json_data.links)
            .enter()
            .append(<span style="color: #BA2121">&quot;path&quot;</span>)
            .attr(<span style="color: #BA2121">&quot;class&quot;</span>, <span style="color: #BA2121">&quot;link&quot;</span>)
            .attr(<span style="color: #BA2121">&quot;d&quot;</span>, path)
            .style(<span style="color: #BA2121">&quot;fill&quot;</span>, <span style="color: #BA2121">&quot;none&quot;</span>)
            .style(<span style="color: #BA2121">&quot;stroke-width&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) { <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">Math</span>.max(<span style="color: #666666">1</span>, (d.dy)); })
            .style(<span style="color: #BA2121">&quot;stroke&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                                    <span style="color: #008000; font-weight: bold">return</span> d.color <span style="color: #666666">?</span> d.color
                                    <span style="color: #666666">:</span> d.source.inherit_right <span style="color: #666666">?</span> d.source.color
                                    <span style="color: #666666">:</span> d.target.inherit_left <span style="color: #666666">?</span> d.target.color
                                    <span style="color: #666666">:</span> data_set.default_flow_inherit <span style="color: #666666">===</span> <span style="color: #BA2121">&quot;source&quot;</span> <span style="color: #666666">?</span> d.source.color
                                    <span style="color: #666666">:</span> data_set.default_flow_inherit <span style="color: #666666">===</span> <span style="color: #BA2121">&quot;target&quot;</span> <span style="color: #666666">?</span> d.target.color
                                    <span style="color: #666666">:</span> data_set.default_flow_color;
            })
            .style(<span style="color: #BA2121">&quot;stroke-opacity&quot;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                                    <span style="color: #008000; font-weight: bold">return</span> d.opacity <span style="color: #666666">||</span> data_set.default_flow_opacity;
            })
            .on(<span style="color: #BA2121">&#39;mouseover&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                d3.select(<span style="color: #008000; font-weight: bold">this</span>).style(<span style="color: #BA2121">&quot;stroke-opacity&quot;</span>,
                    d.opacity_on_hover
                                    <span style="color: #666666">||</span> ((<span style="color: #008000">Number</span>(data_set.default_flow_opacity) <span style="color: #666666">+</span> <span style="color: #666666">1</span>) <span style="color: #666666">/</span> <span style="color: #666666">2</span>));
            })
            .on(<span style="color: #BA2121">&#39;mouseout&#39;</span>, <span style="color: #008000; font-weight: bold">function</span> (d) {
                d3.select(<span style="color: #008000; font-weight: bold">this</span>).style(<span style="color: #BA2121">&quot;stroke-opacity&quot;</span>,
                    d.opacity <span style="color: #666666">||</span> data_set.default_flow_opacity);
            })
            .sort(<span style="color: #008000; font-weight: bold">function</span> (a, b) { <span style="color: #008000; font-weight: bold">return</span> b.dy <span style="color: #666666">-</span> a.dy; });
</pre>
                                </td>
                            </tr>
                        </table>
                    </div>



                    <br>

                    This block of code responsible for creating the Cubic Bézier Curves. This is also quite straight forward. From given link data it generate the Cubic Bézier Curve. We will more into
                    this code specially lets see how the link data is formed. 

                    <br>

                    <div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <table>
                            <tr>
                                <td>
                                    <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre>
                                </td>
                                <td>
                                    <pre style="margin: 0; line-height: 125%">sankey.link <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">function</span> () {
                                    <span style="color: #008000; font-weight: bold">var</span> curvature <span style="color: #666666">=</span> .<span style="color: #666666">5</span>;
                                    <span style="color: #008000; font-weight: bold">function</span> link(d) {
                                    <span style="color: #008000; font-weight: bold">var</span> x0 <span style="color: #666666">=</span> d.source.x <span style="color: #666666">+</span> d.source.dx,          <span style="color: #408080; font-style: italic">// d.source.x is the x position of source node and d.source.dx is the width source node</span>
                x1 <span style="color: #666666">=</span> d.target.x,                        <span style="color: #408080; font-style: italic">// d.target.x is the x position of target node</span>
                xi <span style="color: #666666">=</span> d3.interpolateNumber(x0, x1),      <span style="color: #408080; font-style: italic">// interpolate between x0 and x1</span>
                x2 <span style="color: #666666">=</span> xi(curvature),                     <span style="color: #408080; font-style: italic">// curvature is the property which controls how much curvy the link will be (value ranges from 0-.9)</span>
                x3 <span style="color: #666666">=</span> xi(<span style="color: #666666">1</span> <span style="color: #666666">-</span> curvature),
                y0 <span style="color: #666666">=</span> d.source.y <span style="color: #666666">+</span> d.sy <span style="color: #666666">+</span> d.dy <span style="color: #666666">/</span> <span style="color: #666666">2</span>,      <span style="color: #408080; font-style: italic">// d.sy is calculated based on link widh and how many links are associated with each source node and d.dy is the height of node</span>
                y1 <span style="color: #666666">=</span> d.target.y <span style="color: #666666">+</span> d.ty <span style="color: #666666">+</span> d.dy <span style="color: #666666">/</span> <span style="color: #666666">2</span>;      <span style="color: #408080; font-style: italic">// d.ty is calculated based on link widh and how many links are associated with each target node</span>
                                    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;M&quot;</span> <span style="color: #666666">+</span> x0 <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> y0
                                    <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;C&quot;</span> <span style="color: #666666">+</span> x2 <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> y0
                                    <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; &quot;</span> <span style="color: #666666">+</span> x3 <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> y1
                                    <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; &quot;</span> <span style="color: #666666">+</span> x1 <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> y1;
        }
        link.curvature <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">function</span> (_) {
                                    <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>arguments.length) <span style="color: #008000; font-weight: bold">return</span> curvature;
            curvature <span style="color: #666666">=</span> <span style="color: #666666">+</span>_;
                                    <span style="color: #008000; font-weight: bold">return</span> link;
        };
                                    <span style="color: #008000; font-weight: bold">return</span> link;
    };
</pre>
                                </td>
                            </tr>
                        </table>
                    </div>


                    So we can see how the coordinate values are calculated. From two node position (source and target), this link function use some mathematical terms and finally return the values
                    which are needed to draw these Cubic Bézier Curves (see more in section 4.2). <br> <br> 
                    
                    Here comes our main challenge. We have our node properties and we also get our link properties from above function right away (you could say from the very first block of code of sankey
                    script). And we already know link (Cubic Bézier Curve) coordinates are based on the source and target node position. Later when we draw the rectangles using the user give node data
                    we also use the rotation value to rotate the rectangle. Once we rotate the rectangle, the x and y coordinate position of source and target rectangle changes. We already know that
                    the Cubic Bézier Curve properties (staring point, first control point, second control point and ending point) are directly calculated from source and target node/rectangle position.
                    As we are rotating the nodes, we have to change the link function also to re-calculate link properties based on the new source and target node position. 
                    To adjust this change we have to understand the coordinate transformation.
                    <br>

                </div>

                <br>
                <br>
                <div id="div_SVG_2">
                    <h3>4.2.2 Coordinate transformation of Rectangles and Curves</h3>

                    While working with straight rectangle (with 0 degree orientation), we saw our link function basically work on every coordinate points of nodes. Therefore, we need to know 
                    what will be new coordinate points of every node once we rotate with specified angle (let's say θ). In the figure bellow we can see how the coordinate points are changing after 
                    imposing θ.


                    <img style="border:thick; display: block;   margin: 0 auto;" height="450" width="650" src="resource_files/circular_sankey_02.png" />

                    So, initial point (X2',Y2') will be transformed into new point (X2, Y2) using the formula-<br>
                    <span style="font-size:14px; padding-left:25em; color:green; text-decoration: none;">X2=X1 + (width * cosθ)</span> <br>
                    <span style="font-size:14px; padding-left:25em; color:green; text-decoration: none;">Y2=Y1 + (width * sinθ)</span> <br>

                    where width is the corresponding node width and θ is the corresponding node orientation value. Both values are user defined and can be found in node data. Based on this
                    coordinate transformation idea we can re-calculate all the new points of Cubic Bézier Curves in link function. 
                    <br>
                    <br>
                    Let's have a look into our new link function.
                    <br>

                    <!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;background-color: #fbedbb;     color: #000000;     font-size: 12px;">
                        <table>
                            <tr>
                                <td>
                                    <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
                                </td>
                                <td>
                                    <pre style="margin: 0; line-height: 125%">sankey.link <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">function</span> () {
                                    <span style="color: #008000; font-weight: bold">function</span> link(d) {
                                    <span style="color: #008000; font-weight: bold">var</span> x0 <span style="color: #666666">=</span> d.source.x <span style="color: #666666">+</span> d.source.dx,          <span style="color: #408080; font-style: italic">// d.source.x is the x position of source node and d.source.dx is the width source node</span>
                x1 <span style="color: #666666">=</span> d.target.x,                        <span style="color: #408080; font-style: italic">// d.target.x is the x position of target node</span>
                xi <span style="color: #666666">=</span> d3.interpolateNumber(x0, x1),      <span style="color: #408080; font-style: italic">// interpolate between x0 and x1</span>
                y0 <span style="color: #666666">=</span> d.source.y <span style="color: #666666">+</span> d.sy <span style="color: #666666">+</span> d.dy <span style="color: #666666">/</span> <span style="color: #666666">2</span>,      <span style="color: #408080; font-style: italic">// d.sy is calculated based on link widh and how many links are associated with each source node and d.dy is the height of node</span>
                y1 <span style="color: #666666">=</span> d.target.y <span style="color: #666666">+</span> d.ty <span style="color: #666666">+</span> d.dy <span style="color: #666666">/</span> <span style="color: #666666">2</span>,      <span style="color: #408080; font-style: italic">// d.ty is calculated based on link widh and how many links are associated with each target node</span>
                x_2 <span style="color: #666666">=</span> d.source.x <span style="color: #666666">+</span> (d.source.dx <span style="color: #666666">*</span> <span style="color: #008000">Math</span>.cos((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.source.angle)),      <span style="color: #408080; font-style: italic">// x2_source = d.source.x + (node_width * cosθ)</span>
                y_2 <span style="color: #666666">=</span> d.source.y <span style="color: #666666">+</span> (d.source.dx <span style="color: #666666">*</span> <span style="color: #008000">Math</span>.sin((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.source.angle)),      <span style="color: #408080; font-style: italic">// y2_source = d.source.y + (node_width * sinθ)</span>
                x0_r <span style="color: #666666">=</span> x_2 <span style="color: #666666">-</span> ((d.sy <span style="color: #666666">+</span> d.dy <span style="color: #666666">/</span> <span style="color: #666666">2</span>) <span style="color: #666666">*</span> <span style="color: #008000">Math</span>.sin((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.source.angle)),      <span style="color: #408080; font-style: italic">// final x0_r from x2_source with the value of d.sy and d.dy</span>
                y0_r <span style="color: #666666">=</span> y_2 <span style="color: #666666">+</span> ((d.sy <span style="color: #666666">+</span> d.dy <span style="color: #666666">/</span> <span style="color: #666666">2</span>) <span style="color: #666666">*</span> <span style="color: #008000">Math</span>.cos((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.source.angle)),      <span style="color: #408080; font-style: italic">// final y0_r from x2_source with the value of d.sy and d.dy</span>
                x_2_t <span style="color: #666666">=</span> d.target.x <span style="color: #666666">+</span> (<span style="color: #008000">Math</span>.cos((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.target.angle)),                  <span style="color: #408080; font-style: italic">// x_2_t_target = d.target.x + (cosθ)</span>
                y_2_t <span style="color: #666666">=</span> d.target.y <span style="color: #666666">+</span> (<span style="color: #008000">Math</span>.sin((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.target.angle)),                  <span style="color: #408080; font-style: italic">// y_2_t_target = d.target.y + (sinθ)</span>
                x1_r <span style="color: #666666">=</span> x_2_t <span style="color: #666666">-</span> ((d.ty <span style="color: #666666">+</span> d.dy <span style="color: #666666">/</span> <span style="color: #666666">2</span>) <span style="color: #666666">*</span> <span style="color: #008000">Math</span>.sin((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.target.angle)),    <span style="color: #408080; font-style: italic">// final x1_r from x_2_t_target with the value of d.ty and d.dy</span>
                y1_r <span style="color: #666666">=</span> y_2_t <span style="color: #666666">+</span> ((d.ty <span style="color: #666666">+</span> d.dy <span style="color: #666666">/</span> <span style="color: #666666">2</span>) <span style="color: #666666">*</span> <span style="color: #008000">Math</span>.cos((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.target.angle)),    <span style="color: #408080; font-style: italic">// final y1_r from y_2_t_target with the value of d.ty and d.dy</span>
                distance <span style="color: #666666">=</span> <span style="color: #008000">Math</span>.sqrt((x0 <span style="color: #666666">-</span> x1) <span style="color: #666666">*</span> (x0 <span style="color: #666666">-</span> x1) <span style="color: #666666">+</span> (y0 <span style="color: #666666">-</span> y1) <span style="color: #666666">*</span> (y0 <span style="color: #666666">-</span> y1))                 <span style="color: #408080; font-style: italic">// Euclidien distance between source and target</span>
                x2 <span style="color: #666666">=</span> x0_r <span style="color: #666666">+</span> <span style="color: #008000">Math</span>.cos((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.source.angle) <span style="color: #666666">*</span> distance <span style="color: #666666">*</span> curvature,          <span style="color: #408080; font-style: italic">// x position for source control point </span>
                y0_r_r <span style="color: #666666">=</span> y0_r <span style="color: #666666">+</span> <span style="color: #008000">Math</span>.sin((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> d.source.angle) <span style="color: #666666">*</span> distance <span style="color: #666666">*</span> curvature,      <span style="color: #408080; font-style: italic">// Y position for source control point </span>
                x3 <span style="color: #666666">=</span> x1_r <span style="color: #666666">+</span> <span style="color: #008000">Math</span>.cos((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> (d.target.angle <span style="color: #666666">+</span> <span style="color: #666666">180</span>)) <span style="color: #666666">*</span> distance <span style="color: #666666">*</span> curvature,      <span style="color: #408080; font-style: italic">// x position for target control point </span>
                y1_r_r <span style="color: #666666">=</span> y1_r <span style="color: #666666">+</span> <span style="color: #008000">Math</span>.sin((<span style="color: #008000">Math</span>.PI <span style="color: #666666">/</span> <span style="color: #666666">180</span>) <span style="color: #666666">*</span> (d.target.angle <span style="color: #666666">+</span> <span style="color: #666666">180</span>)) <span style="color: #666666">*</span> distance <span style="color: #666666">*</span> curvature;      <span style="color: #408080; font-style: italic">// y position for target control point </span>
                                    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;M&quot;</span> <span style="color: #666666">+</span> x0_r <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> y0_r
                                    <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;C&quot;</span> <span style="color: #666666">+</span> x2 <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> y0_r_r
                                    <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; &quot;</span> <span style="color: #666666">+</span> x3 <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> y1_r_r
                                    <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; &quot;</span> <span style="color: #666666">+</span> x1_r <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;,&quot;</span> <span style="color: #666666">+</span> y1_r;
            }
        link.curvature <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">function</span> (_) {
                                    <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>arguments.length) <span style="color: #008000; font-weight: bold">return</span> curvature;
            curvature <span style="color: #666666">=</span> <span style="color: #666666">+</span>_;
                                    <span style="color: #008000; font-weight: bold">return</span> link;
        };
                                    <span style="color: #008000; font-weight: bold">return</span> link;
    };
</pre>
                                </td>
                            </tr>
                        </table>
                    </div>



                </div>


              

                <br>
                <br>
                <div id="div_database">
                    <h3>4.3 Saving Data Into Database</h3>
                    Circular Sankey offers the option of storing data. An unique job id is created every time user wants to save the data into database. There is a datagrid which shows
                    all the job id's that specific user created so for. User can easily view the meta data and the actual diagram data. It is also possible to navigate and recreate the exactly
                    same diagram with exactly same values that user left last time. So, we can say no user history will be lost.
                    <br>
                    <img style="border:thick; display: block;   margin: 0 auto; border-bottom:1px solid; padding-top:50px;" width="100%" src="resource_files/screen_04.png" />
                </div>
                <br>

                <br>

                <div id="div_exportSVG">
                    <h3>4.4 Exporting Diagram as SVG</h3>
                    After successful completion of the diagram user can download the diagram as svg format. Other image format could be an option which we might focus in future.
                    <br>

                </div>
                <br>
                <br>
                <div id="div_userHistory">
                    <h2>5. Managing User History</h2>
                    Circular Sankey also have a portal for user maintenance page which is only accessible by admin type of users. An admin can fill the registration fields and create a new user.
                    There is also other necessary measurements which ensure that every user is unique and no user will be able to view or access the data or history of other users. <br>
                    <img style="border:thick; display: block;   margin: 0 auto; border-bottom:1px solid; padding-top:50px;" width="100%" src="resource_files/screen_07.png" />
                    <br>

                </div>
                <br>

                <br>

                <div id="div_conclusion">
                    <h2>6. Conclusion</h2>

                    A graphical representation of some abstract idea is always much meaningful and easy to understand. When we have some complex statistical data, the idea of representing it into some kind
                    of pictorial form could be very useful. This is the point of interest for the people who like to work with the technology of data visualization. Sankey diagram is widely used graphical
                    way to describe statistical data of industrial and material flow. The number of available online tool of creating sankey diagram from raw data is still not enough or not good enough 
                    to deal with increasing number of user's expectations.
                    Moreover, they are often found unable to handle exceptions. Introducing circular behavior was one of these main exceptions or better say user expectation which has been discussed
                    recently. We also found some other areas which could also be a point of interest in near future. A much closer look into D3.js will essentially increase the performance of circular
                    sankey and meet the emerging need of experts in coming days.

                </div>
                <br>

                <br>
                <div id="div_reference">
                    <h2>7. References</h2>
                    <a style="color:green; text-decoration: none; font-size:12px" href="http://www.d3noob.org/2013/02/sankey-diagrams-description-of-d3js-code.html">
                        Sankey Diagrams: A Description of the d3.js Code
                    </a>

                    <br>
                    <a style="color:green; text-decoration: none; font-size:12px" href="https://bost.ocks.org/mike/sankey/">
                        Sankey Diagram by Mike Bostock
                    </a>
                    
                    <br>
                    <a style="color:green; text-decoration: none; font-size:12px" href="http://sankeymatic.com/">
                        Sankey Matik- an online tool for making sankey diagarm
                    </a>
                    
                    <br>
                    <a style="color:green; text-decoration: none; font-size:12px" href="https://leanpub.com/D3-Tips-and-Tricks/read#leanpub-auto-what-is-a-sankey-diagram">
                        D3 Tips and Tricks v3.x by Mike Bostock
                    </a>
                    
                    <br>
                    <a style="color:green; text-decoration: none; font-size:12px" href="https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths">
                        SVG paths and shapes
                    </a>
                    
                    <br>
                    <a style="color:green; text-decoration: none; font-size:12px" href="http://www.svgbasics.com/paths.html">
                        Creating Paths with SVG
                    </a>
                    <br>

                </div>

                <div class="clr"></div>
            </div>

        </div>


       
    </div>
</body>
</html>
